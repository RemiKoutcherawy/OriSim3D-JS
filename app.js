((OR=OR||{}).Point=function(t,e,n,i,r){3===arguments.length?(this.x=t,this.y=e,this.z=n,this.xf=t,this.yf=e):2===arguments.length?(this.xf=t,this.yf=e,this.x=t,this.y=e,this.z=0):(this.xf=0|t,this.yf=0|e,this.x=0|n,this.y=0|i,this.z=0|r),this.select=!1,this.set5d=function(t,e,n,i,r){return this.xf=0|t,this.yf=0|e,this.x=0|n,this.y=0|i,this.z=0|r,this},this.set3d=function(t,e,n){return this.x=0|t,this.y=0|e,this.z=0|n,this},this.set2d=function(t,e){return this.xf=0|t,this.yf=0|e,this},this.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},this.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this},this.norm=function(){var t=this.length();return this.scale(1/t)},this.toString=function(){return"["+Math.round(this.x)+","+Math.round(this.y)+","+Math.round(this.z)+"  "+Math.round(this.xf)+","+Math.round(this.yf)+"]"},this.toXYZString=function(){return"["+Math.round(this.x)+","+Math.round(this.y)+","+Math.round(this.z)+"]"},this.toXYString=function(){return"["+Math.round(this.xf)+","+Math.round(this.yf)+"]"}},OR.Point.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},OR.Point.add=function(t,e){return new OR.Point(t.x+e.x,t.y+e.y,t.z+e.z)},OR.Point.sub=function(t,e){return new OR.Point(t.x-e.x,t.y-e.y,t.z-e.z)},OR.Point.compare3d=function(t,e,n,i){if(2===arguments.length){var r=(t.x-e.x)*(t.x-e.x),o=(t.y-e.y)*(t.y-e.y),s=(t.z-e.z)*(t.z-e.z),a=r+o+s;a=a>1?a:0}else a=(a=(r=(t.x-e)*(t.x-e))+(o=(t.y-n)*(t.y-n))+(s=(t.z-i)*(t.z-i)))>1?a:0;return a},OR.Point.compare2d=function(t,e){var n=(t.xf-e.xf)*(t.xf-e.xf),i=(t.yf-e.yf)*(t.yf-e.yf);return Math.sqrt(n+i)},"undefined"!=typeof exports&&(module.exports=OR.Point),"function"==typeof require)&&((OR=OR||{}).Point=require("./Point.js"));(OR.Plane=function(t,e){this.r=t,this.n=e,this.isOnPlane=function(t){var e=OR.Point.sub(t,this.r),n=OR.Point.dot(e,this.n);return Math.abs(n)<.1},this.intersectPoint=function(t,e){var n=new OR.Point(e.x-t.x,e.y-t.y,e.z-t.z),i=OR.Point.dot(n,this.n);if(0===i)return null;var r=(OR.Point.dot(this.r,this.n)-OR.Point.dot(t,this.n))/i;return r>=0&&r<=1?OR.Point.add(t,n.scale(r)):null},this.intersectSeg=function(t){var e=new OR.Point(t.p2.x-t.p1.x,t.p2.y-t.p1.y,t.p2.z-t.p1.z),n=OR.Point.dot(e,this.n);if(0===n)return null;var i=(OR.Point.dot(this.r,this.n)-OR.Point.dot(t.p1,this.n))/n;return i>=0&&i<=1?OR.Point.add(t.p1,e.scale(i)):null},this.classifyPointToPlane=function(t){var e=OR.Point.dot(this.r,this.n)-OR.Point.dot(this.n,t);return e>OR.Plane.THICKNESS?1:e<-OR.Plane.THICKNESS?-1:0},this.toString=function(){return"Pl[r:"+this.r+" n:"+this.n+"]"}},OR.Plane.THICKNESS=1,OR.Plane.across=function(t,e){var n=new OR.Point((t.x+e.x)/2,(t.y+e.y)/2,(t.z+e.z)/2),i=new OR.Point(e.x-t.x,e.y-t.y,e.z-t.z);return new OR.Plane(n,i)},OR.Plane.by=function(t,e){var n=new OR.Point(t.x,t.y,t.z),i=new OR.Point(e.y-t.y,-(e.x-t.x),0);return new OR.Plane(n,i)},OR.Plane.ortho=function(t,e){var n=new OR.Point(e.x,e.y,e.z),i=new OR.Point(t.p2.x-t.p1.x,t.p2.y-t.p1.y,t.p2.z-t.p1.z);return new OR.Plane(n,i)},"undefined"!=typeof exports&&(module.exports=OR.Plane),"function"==typeof require)&&((OR=OR||{}).Point=require("./Point.js"));(OR.Segment=function(t,e,n){this.p1=t,this.p2=e,this.type=OR.Segment.PLAIN|n,this.angle=0,this.select=!1,this.reverse=function(){var t=this.p1;this.p1=this.p2,this.p2=t},this.length3d=function(){return Math.sqrt((this.p1.x-this.p2.x)*(this.p1.x-this.p2.x)+(this.p1.y-this.p2.y)*(this.p1.y-this.p2.y)+(this.p1.z-this.p2.z)*(this.p1.z-this.p2.z))},this.length2d=function(){return Math.sqrt((this.p1.xf-this.p2.xf)*(this.p1.xf-this.p2.xf)+(this.p1.yf-this.p2.yf)*(this.p1.yf-this.p2.yf))},this.toString=function(){return"S(P1:"+this.p1.toXYZString()+" "+this.p1.toXYString()+", P2:"+this.p2.toXYZString()+" "+this.p2.toXYString()+")"}},OR.Segment.PLAIN=0,OR.Segment.EDGE=1,OR.Segment.MOUNTAIN=2,OR.Segment.VALLEY=3,OR.Segment.TEMPORARY=-1,OR.Segment.EPSILON=.01,OR.Segment.compare=function(t,e){var n=OR.Point.compare3d(t.p1,e.p1)+OR.Point.compare3d(e.p2,e.p2);return n>1?n:0},OR.Segment.distanceToSegment=function(t,e){var n=t.p1.x,i=t.p1.y,r=t.p2.x,o=t.p2.y,s=e.x,a=e.y,h=(n-r)*(n-r)+(i-o)*(i-o),l=((i-a)*(i-o)+(n-s)*(n-r))/h,u=((i-a)*(r-n)-(n-s)*(o-i))/h;return l<=0?Math.sqrt((s-n)*(s-n)+(a-i)*(a-i)):l>=1?Math.sqrt((s-r)*(s-r)+(a-o)*(a-o)):Math.abs(u)*Math.sqrt(h)},OR.Segment.closestSeg=function(t,e){var n,i,r,o=new OR.Point(t.p2.x-t.p1.x,t.p2.y-t.p1.y,t.p2.z-t.p1.z),s=new OR.Point(e.p2.x-e.p1.x,e.p2.y-e.p1.y,e.p2.z-e.p1.z),a=new OR.Point(t.p1.x-e.p1.x,t.p1.y-e.p1.y,t.p1.z-e.p1.z),h=OR.Point.dot(o,o),l=OR.Point.dot(s,s),u=OR.Point.dot(s,a);if(h<=OR.Segment.EPSILON&&l<=OR.Segment.EPSILON)n=i=0,r=new OR.Segment(t.p1,e.p1,OR.Segment.TEMPORARY);else{if(h<=OR.Segment.EPSILON)n=0,i=(i=u/l)<0?0:i>1?1:i;else{var p=OR.Point.dot(o,a);if(l<=OR.Segment.EPSILON)i=0,n=(n=-p/h)<0?0:n>1?1:n;else{var c=OR.Point.dot(o,s),f=h*l-c*c;(i=(c*(n=0!==f?(n=(c*u-p*l)/f)<0?0:n>1?1:n:0)+u)/l)<0?(i=0,n=(n=-p/h)<0?0:n>1?1:n):i>1&&(i=1,n=(n=(c-p)/h)<0?0:n>1?1:n)}}var d=OR.Point.add(t.p1,o.scale(n)),m=OR.Point.add(e.p1,s.scale(i));r=new OR.Segment(d,m)}return r},OR.Segment.closestLine=function(t,e){var n,i,r,o=new OR.Point(t.p2.x-t.p1.x,t.p2.y-t.p1.y,t.p2.z-t.p1.z),s=new OR.Point(e.p2.x-e.p1.x,e.p2.y-e.p1.y,e.p2.z-e.p1.z),a=new OR.Point(t.p1.x-e.p1.x,t.p1.y-e.p1.y,t.p1.z-e.p1.z),h=OR.Point.dot(o,o),l=OR.Point.dot(s,s),u=OR.Point.dot(s,a);if(h<=OR.Segment.EPSILON&&l<=OR.Segment.EPSILON)n=i=0,r=new OR.Segment(t.p1,e.p1,OR.Segment.TEMPORARY,-1);else{if(h<=OR.Segment.EPSILON)n=0,i=u/l;else{var p=OR.Point.dot(o,a);if(l<=OR.Segment.EPSILON)i=0,n=-p/h;else{var c=OR.Point.dot(o,s),f=h*l-c*c;i=(c*(n=0!==f?(c*u-p*l)/f:0)+u)/l}}var d=OR.Point.add(t.p1,o.scale(n)),m=OR.Point.add(e.p1,s.scale(i));r=new OR.Segment(d,m)}return r},"undefined"!=typeof exports&&(module.exports=OR.Segment),"function"==typeof require)&&((OR=OR||{}).Point=require("./Point.js"));(OR.Face=function(){this.points=[],this.normal=[0,0,1],this.select=0,this.highlight=!1,this.offset=0,this.computeFaceNormal=function(){if(this.points.length<3)return console.log("Warn Face < 3pts:"+this),null;for(var t=0;t<this.points.length-2;t++){var e=this.points[t],n=this.points[t+1],i=this.points[t+2],r=[n.x-e.x,n.y-e.y,n.z-e.z],o=[i.x-e.x,i.y-e.y,i.z-e.z];if(this.normal[0]=r[1]*o[2]-r[2]*o[1],this.normal[1]=r[2]*o[0]-r[0]*o[2],this.normal[2]=r[0]*o[1]-r[1]*o[0],Math.abs(this.normal[0])+Math.abs(this.normal[1])+Math.abs(this.normal[2])>.1)break}return function(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}(this.normal),this.normal},this.toString=function(){var t="F(";return this.points.forEach(function(e,n,i){t=t+"P"+n+e.toString()+(n===i.length-1?"":" ")}),t+=")"}},"undefined"!=typeof exports&&(module.exports=OR.Face),"function"==typeof require)&&((OR=OR||{}).Point=require("./Point.js"),OR.Segment=require("./Segment.js"),OR.Face=require("./Face.js"),OR.Plane=require("./Plane.js"));if(OR.Model=function(t){function e(t){this.points=[],this.segments=[],this.faces=[];for(var e=new OR.Face,n=null,i=0;i<t.length;i+=2){var r=this.addPointXYZ(t[i],t[i+1],t[i],t[i+1],0);e.points.push(r),null!==n&&this.addSegment(n,r,OR.Segment.EDGE),n=r}this.addSegment(n,e.points[0],OR.Segment.EDGE),this.addFace(e),this.needRebuild=!0}this.points=[],this.segments=[],this.faces=[],this.needRebuild=!0,this.change=!0,this.init=e,this.addPointXYZ=function(t,e,n,i,r){var o=null;return 2===arguments.length?o=new OR.Point(t,e):3===arguments.length?o=new OR.Point(n,i,r):5===arguments.length?o=new OR.Point(t,e,n,i,r):console.log("Warn wrong number of Args for addPointXYZ"),this.points.push(o),o},this.addPoint=function(t){for(var e=0;e<this.points.length;e++)if(OR.Point.compare3d(this.points[e],t)<1)return this.points[e];return this.points.push(t),t},this.addSegment=function(t,e,n){if(0===OR.Point.compare3d(t,e))return console.log("Warn Add degenerate segment:"+t),null;var i=new OR.Segment(t,e,n);return this.segments.push(i),i},this.addFace=function(t){return this.faces.push(t),t},this.searchSegmentsOnePoint=function(t){var e=[];return this.segments.forEach(function(n){n.p1!==t&&n.p2!==t||e.push(n)}),e},this.searchSegmentTwoPoints=function(t,e){var n=[];return this.segments.forEach(function(i){(0===OR.Point.compare3d(i.p1,t)&&0===OR.Point.compare3d(i.p2,e)||0===OR.Point.compare3d(i.p2,t)&&0===OR.Point.compare3d(i.p1,e))&&n.push(i)}),n.length>1&&console.log("Error More than one segment on 2 points:"+n.length+" "+n[0].p1+n[0].p2+" "+n[1].p1+n[1].p2),0===n.length?null:n[0]},this.align2dFrom3d=function(t,e){var n=Math.sqrt((e.p1.x-t.x)*(e.p1.x-t.x)+(e.p1.y-t.y)*(e.p1.y-t.y)+(e.p1.z-t.z)*(e.p1.z-t.z))/e.length3d();t.xf=e.p1.xf+n*(e.p2.xf-e.p1.xf),t.yf=e.p1.yf+n*(e.p2.yf-e.p1.yf)},this.faceLeft=function(t,e){var n,i;void 0===e&&(e=t.p2,t=t.p1);var r=null;return this.faces.forEach(function(o){(n=o.points.indexOf(t))>=0&&(i=o.points.indexOf(e))>=0&&(i===n+1||n===o.points.length-1&&0===i)&&(r=o)}),r},this.faceRight=function(t,e){void 0===e&&(e=t.p2,t=t.p1);var n=0,i=0,r=null;return this.faces.forEach(function(o){(n=o.points.indexOf(t))>=0&&(i=o.points.indexOf(e))>=0&&(n===i+1||i===o.points.length-1&&0===n)&&(r=o)}),r},this.splitFacesByPlane=function(t,e){for(var n=(e=void 0!==e?e:this.faces).length-1;n>-1;n--){var i=e[n];this.splitFaceByPlane(i,t)}},this.splitFaceByPlane=function(t,e){for(var n=[],i=[],r=!1,o=!1,s=null,a=t.points[t.points.length-1],h=e.classifyPointToPlane(a),l=0;l<t.points.length;l++){var u=t.points[l],p=e.classifyPointToPlane(u);if(1===p){if(-1===h){var c=e.intersectPoint(u,a),f=this.addPoint(c);n.push(f),i.push(f);var d=this.searchSegmentTwoPoints(a,u),m=this.segments.indexOf(d);-1!==m&&(this.align2dFrom3d(f,d),this.addSegment(f,u,OR.Segment.PLAIN),d.p1===a?d.p2=f:d.p1=f),null!==s?(this.addSegment(s,f,OR.Segment.PLAIN),s=null):s=f}else 0===h&&(s=a);n.push(u),r=!0}else-1===p?(1===h?(c=e.intersectPoint(u,a),f=this.addPoint(c),n.push(f),i.push(f),d=this.searchSegmentTwoPoints(a,u),-1!==(m=this.segments.indexOf(d))&&(this.align2dFrom3d(f,d),this.addSegment(f,u,OR.Segment.PLAIN),d.p1===a?d.p2=f:d.p1=f),null!==s&&f!==s?(this.addSegment(s,f),s=null):s=f):0===h&&(i[i.length-1]!==a&&i.push(a),null!==s&&s!==a?(this.addSegment(s,a,OR.Segment.PLAIN),s=null):s=a),i.push(u),o=!0):0===p&&(-1===h&&(i.push(u),null!==s&&s!==u?(null===(d=this.searchSegmentTwoPoints(s,u))&&this.addSegment(s,u,OR.Segment.PLAIN),s=null):s=u),n.push(u));a=u,h=p}if(r&&(t.points=n,t=null),o)if(null!==t)t.points=i;else{var g=new OR.Face;g.points=i,this.faces.push(g)}},this.searchFace=function(t,e){var n=t.p1,i=t.p2,r=null;return this.faces.forEach(function(t){null===e&&t.points.indexOf(n)>-1&&t.points.indexOf(i)>-1?r=t:t!==e&&t.points.indexOf(n)>-1&&t.points.indexOf(i)>-1&&(r=t)}),r},this.splitSegmentByPoint=function(t,e){if(0===OR.Point.compare3d(t.p1,e)||0===OR.Point.compare3d(t.p2,e))return t;var n=this.addSegment(e,t.p2,t.type);return t.p2=e,t.length2d(),t.length3d(),n},this.splitSegmentOnPoint=function(t,e){var n=null,i=null;this.align2dFrom3d(e,t);var r=this.searchFace(t,null);if(null!==r&&-1===r.points.indexOf(e))for(n=r.points,i=0;i<n.length;i++){if(n[i]===t.p1&&n[i===n.length-1?0:i+1]===t.p2){n.splice(i+1,0,e);break}if(n[i]===t.p2&&n[i===n.length-1?0:i+1]===t.p1){n.splice(i+1,0,e);break}}var o=this.searchFace(t,r);if(null!==o&&-1===o.points.indexOf(e))for(n=o.points,i=0;i<n.length;i++){if(n[i]===t.p1&&n[i===n.length-1?0:i+1]===t.p2){n.splice(i+1,0,e);break}if(n[i]===t.p2&&n[i===n.length-1?0:i+1]===t.p1){n.splice(i+1,0,e);break}}return this.addPoint(e),this.splitSegmentByPoint(t,e),t},this.splitSegmentByRatio=function(t,e){var n=new OR.Point;n.set3d(t.p1.x+e*(t.p2.x-t.p1.x),t.p1.y+e*(t.p2.y-t.p1.y),t.p1.z+e*(t.p2.z-t.p1.z)),this.splitSegmentOnPoint(t,n)},this.splitCross=function(t,e,n){var i=OR.Plane.across(t,e);this.splitFacesByPlane(i,n)},this.splitBy=function(t,e,n){var i=OR.Plane.by(t,e);this.splitFacesByPlane(i,n)},this.splitOrtho=function(t,e,n){var i=OR.Plane.ortho(t,e);this.splitFacesByPlane(i,n)},this.splitLineToLine=function(t,e,n){var i=OR.Segment.closestLine(t,e);if(i.length3d()<1){var r=i.p1,o=OR.Point.sub(t.p1,r).length()>OR.Point.sub(t.p2,r).length()?t.p1:t.p2,s=OR.Point.sub(e.p1,r).length()>OR.Point.sub(e.p2,r).length()?e.p1:e.p2;this.splitLineToLineByPoints(o,r,s,n)}else{var a=OR.Plane.across(i.p1,i.p2);this.splitFacesByPlane(a,n)}},this.splitLineToLineByPoints=function(t,e,n,i){var r=Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)+(e.z-t.z)*(e.z-t.z))/Math.sqrt((e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y)+(e.z-n.z)*(e.z-n.z)),o=e.x+r*(n.x-e.x),s=e.y+r*(n.y-e.y),a=e.z+r*(n.z-e.z),h=new OR.Point(o,s,a),l=OR.Plane.by(t,h);this.splitFacesByPlane(l,i)},this.computeAngle=function(t){var e=t.p1,n=t.p2,i=this.faceLeft(e,n),r=this.faceRight(e,n);if(t.type===OR.Segment.EDGE)return console.log("Warn Angle on Edge:"+t),0;if(null===r||null===i)return console.log("Warn No right and left face for:"+t+" left:"+i+" right:"+r),0;var o=i.computeFaceNormal(),s=r.computeFaceNormal(),a=o[1]*s[2]-o[2]*s[1],h=o[2]*s[0]-o[0]*s[2],l=o[0]*s[1]-o[1]*s[0],u=t.p2.x-t.p1.x,p=t.p2.y-t.p1.y,c=t.p2.z-t.p1.z,f=(a*u+h*p+l*c)/Math.sqrt(u*u+p*p+c*c),d=o[0]*s[0]+o[1]*s[1]+o[2]*s[2];return d>1&&(d=1),d<-1&&(d=-1),t.angle=Math.acos(d)/Math.PI*180,Number.isNaN(t.angle)&&(t.angle=0),f<0&&(t.angle=-t.angle),t.angle=-t.angle,t.angle},this.rotate=function(t,e,n){var i=e*Math.PI/180,r=t.p1.x,o=t.p1.y,s=t.p1.z,a=t.p2.x-r,h=t.p2.y-o,l=t.p2.z-s,u=1/Math.sqrt(a*a+h*h+l*l);a*=u,h*=u,l*=u;var p=Math.sin(i),c=Math.cos(i),f=1-c,d=f*a*a+c,m=f*a*h-l*p,g=f*a*l+h*p,x=f*h*a+l*p,v=f*h*h+c,y=f*h*l-a*p,R=f*l*a-h*p,O=f*l*h+a*p,P=f*l*l+c;n.forEach(function(t){var e=t.x-r,n=t.y-o,i=t.z-s;t.x=r+d*e+m*n+g*i,t.y=o+x*e+v*n+y*i,t.z=s+R*e+O*n+P*i})},this.turn=function(t,e){e*=Math.PI/180;var n=0,i=0,r=0;1===t?n=1:2===t?i=1:3===t&&(r=1);var o=1/Math.sqrt(n*n+i*i+r*r);n*=o,i*=o,r*=o;var s=Math.sin(e),a=Math.cos(e),h=1-a,l=h*n*n+a,u=h*n*i-r*s,p=h*n*r+i*s,c=h*i*n+r*s,f=h*i*i+a,d=h*i*r-n*s,m=h*r*n-i*s,g=h*r*i+n*s,x=h*r*r+a;this.points.forEach(function(t){var e=t.x-0,n=t.y-0,i=t.z-0;t.x=0+l*e+u*n+p*i,t.y=0+c*e+f*n+d*i,t.z=0+m*e+g*n+x*i})},this.adjust=function(t,e){for(var n=e||this.searchSegmentsOnePoint(t),i=100,r=0;i>.001&&r<20;r++){i=0;for(var o=new OR.Point(0,0,0),s=0;s<n.length;s++){var a=n[s],h=a.length3d(),l=a.length2d(),u=l-h;Math.abs(u)>i&&(i=Math.abs(u));var p=l/h;a.p2===t?(o.x+=a.p1.x+(a.p2.x-a.p1.x)*p,o.y+=a.p1.y+(a.p2.y-a.p1.y)*p,o.z+=a.p1.z+(a.p2.z-a.p1.z)*p):a.p1===t&&(o.x+=a.p2.x+(a.p1.x-a.p2.x)*p,o.y+=a.p2.y+(a.p1.y-a.p2.y)*p,o.z+=a.p2.z+(a.p1.z-a.p2.z)*p)}0!==n.length&&(t.x=o.x/n.length,t.y=o.y/n.length,t.z=o.z/n.length)}return i},this.adjustList=function(t){for(var e=100,n=0;e>.001&&n<100;n++){e=0;for(var i=0;i<t.length;i++){var r=t[i],o=this.searchSegmentsOnePoint(r),s=this.adjust(r,o);Math.abs(s)>e&&(e=Math.abs(s))}}return e},this.evaluate=function(){for(var t=0;t<this.segments.length;t++){var e=this.segments[t],n=Math.abs(e.length2d()-e.length3d());e.highlight=n>=.1}},this.move=function(t,e,n,i){(i=null===i?this.points:void 0===i?this.points:i).forEach(function(i){i.x+=t,i.y+=e,i.z+=n})},this.moveOn=function(t,e,n,i){i.forEach(function(i){i.x=t.x*e+i.x*n,i.y=t.y*e+i.y*n,i.z=t.z*e+i.z*n})},this.flat=function(t){(void 0===t?this.points:t).forEach(function(t){t.z=0})},this.offset=function(t,e){e.forEach(function(e){e.offset+=t})},this.selectSegs=function(t){t.forEach(function(t){t.select=!t.select})},this.selectPts=function(t){t.forEach(function(t){t.select=!t.select})},this.get2DBounds=function(){var t=-100,e=100,n=-100,i=100;this.points.forEach(function(r){var o=r.xf,s=r.yf;o>t&&(t=o),o<e&&(e=o),s>n&&(n=s),s<i&&(i=s)});var r={};return r.xmin=e,r.ymin=i,r.xmax=t,r.ymax=n,r},this.get3DBounds=function(){var t=-200,e=200,n=-200,i=200;this.points.forEach(function(r){var o=r.x,s=r.y;o>t&&(t=o),o<e&&(e=o),s>n&&(n=s),s<i&&(i=s)});var r={};return r.xmin=e,r.ymin=i,r.xmax=t,r.ymax=n,r},this.zoomFit=function(){var t=this.get3DBounds(),e=400/Math.max(t.xmax-t.xmin,t.ymax-t.ymin),n=-(t.xmin+t.xmax)/2,i=-(t.ymin+t.ymax)/2;this.move(n,i,0,null),this.scaleModel(e)},this.scaleModel=function(t){this.points.forEach(function(e){e.x*=t,e.y*=t,e.z*=t})};var n=e.bind(this);t&&n(t)},"undefined"!=typeof exports&&(module.exports=OR.Model),"function"==typeof require)var OR=OR||{};(OR.Interpolator={LinearInterpolator:function(t){return t},AccelerateDecelerateInterpolator:function(t){return Math.cos((t+1)*Math.PI)/2+.5},SpringOvershootInterpolator:function(t){return t<.1825?((-237.11*t+61.775)*t+3.664)*t+0:t<.425?((74.243*t-72.681)*t+21.007)*t-.579:t<.6875?((-16.378*t+28.574)*t-15.913)*t+3.779:t<1?((5.12*t-12.8)*t+10.468)*t-1.788:((-176.823*t+562.753)*t-594.598)*t+209.669},SpringBounceInterpolator:function(t){var e=0;return(e=t<.185?((-94.565*t+28.123)*t+2.439)*t+0:t<.365?((-3.215*t-4.89)*t+5.362)*t+.011:t<.75?((5.892*t-10.432)*t+5.498)*t+.257:t<1?((1.52*t-2.48)*t+.835)*t+1.125:((-299.289*t+945.19)*t-991.734)*t+346.834)>1?2-e:e},GravityBounceInterpolator:function(t){var e=0;return(e=t<.29?((-14.094*t+9.81)*t-.142)*t+0:t<.62?((-16.696*t+21.298)*t-6.39)*t+.909:t<.885?((31.973*t-74.528)*t+56.497)*t-12.844:t<1?((-37.807*t+114.745)*t-114.938)*t+39:((-7278.029*t+22213.034)*t-22589.244)*t+7655.239)>1?2-e:e},BounceInterpolator:function(t){function e(t){return t*t*8}return(t*=1.1226)<.3535?e(t):t<.7408?e(t-.54719)+.7:t<.9644?e(t-.8526)+.9:e(t-1.0435)+.95},OvershootInterpolator:function(t){return(t-=1)*t*(3*t+2)+1},AnticipateInterpolator:function(t){return t*t*(1*t-0)},AnticipateOvershootInterpolator:function(t){return t<.5?.5*function(t,e){return t*t*((e+1)*t-e)}(2*t,1.5):.5*(function(t,e){return t*t*((e+1)*t+e)}(2*t-2,1.5)+2)}},"undefined"!=typeof exports&&(module.exports=OR.Interpolator),"function"==typeof require)&&((OR=OR||{}).Interpolator=require("./Interpolator.js"));OR.Command=function(t){var e,n,i,r,o,s=t,a=[],h=[],l=0,u=State.idle,p=1,c=0,f=[0,0,0,0],d=OR.Interpolator.LinearInterpolator,m=1,g=this;function x(t){var e=t.replace(/[\);]/g," rparent");return e=(e=e.replace(/,/g," ")).replace(/\/\/.*$/gm,""),a=e.split(/\s+/),l=0,g.toko=a,a}function v(t){var e=null;if("function"==typeof require){const n=require("fs");e=n.readFileSync(t,"utf-8")}else{const n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE&&200===n.status){n.getResponseHeader("Content-Type").match(/^text/)&&(e=n.responseText)}else n.readyState!==XMLHttpRequest.OPENED&&console.log("Error ? state:"+n.readyState+" status:"+n.status)},n.open("GET",t,!1),n.send(null)}return null===e&&console.log("Error reading:"+t),e}function y(){var t=[],e=null,n=null,i=null,r=null,o=null;if("d"===a[l]||"define"===a[l]){for(l++;Number.isInteger(Number(a[l]));)t.push(a[l++]);s.init(t)}else if("b"===a[l]||"by"===a[l])l++,e=s.points[a[l++]],n=s.points[a[l++]],s.splitBy(e,n);else if("c"===a[l]||"cross"===a[l])l++,e=s.points[a[l++]],n=s.points[a[l++]],s.splitCross(e,n);else if("p"===a[l]||"perpendicular"===a[l])l++,r=s.segments[a[l++]],o=s.points[a[l++]],s.splitOrtho(r,o);else if("lol"===a[l]||"lineonline"===a[l]){l++;var h=s.segments[a[l++]],u=s.segments[a[l++]];s.splitLineToLine(h,u)}else if("s"===a[l]||"split"===a[l]){l++,r=s.segments[a[l++]];var d=a[l++],x=a[l++];s.splitSegmentByRatio(r,d/x)}else if("r"===a[l]||"rotate"===a[l])l++,r=s.segments[a[l++]],i=a[l++]*(p-c),t=R(),s.rotate(r,i,t);else if("f"===a[l]||"fold"===a[l]){l++,r=s.segments[a[l++]];var v=0;0===c&&(v=s.computeAngle(r)),i=(a[l++]-v)*(p-c),t=R(),0===c&&-1!==s.faceRight(r.p1,r.p2).points.indexOf(t[0])&&r.reverse(),s.rotate(r,i,t)}else if("a"===a[l]||"adjust"===a[l]){l++;var y=0===(t=R()).length?s.points:t;s.adjustList(y)}else if("o"===a[l]||"offset"===a[l]){l++;var O=a[l++]*m;t=function(){var t=[];for(;Number.isInteger(Number(a[l]));)t.push(s.faces[a[l++]]);return t}(),s.offset(O,t)}else if("m"===a[l]||"move"===a[l])l++,s.move(a[l++]*(p-c),a[l++]*(p-c),a[l++]*(p-c),s.points);else if("mo"===a[l]){l++;var P=s.points.get(a[l++]),w=(1-p)/(1-c),S=p-c*w;s.moveOn(P,S,w,s.points)}else if("tx"===a[l])l++,s.turn(1,Number(a[l++])*(p-c));else if("ty"===a[l])l++,s.turn(2,Number(a[l++])*(p-c));else if("tz"===a[l])l++,s.turn(3,Number(a[l++])*(p-c));else if("z"===a[l]){l++;var T=a[l++],E=a[l++],M=a[l++],A=(1+p*(T-1))/(1+c*(T-1)),z=T*(p/A-c);s.move(E*z,M*z,0,null),s.scaleModel(A)}else if("zf"===a[l]){if(l++,0===c){n=s.get3DBounds();f[0]=400/Math.max(n.xmax-n.xmin,n.ymax-n.ymin),f[1]=-(n.xmin+n.xmax)/2,f[2]=-(n.ymin+n.ymax)/2}T=(1+p*(f[0]-1))/(1+c*(f[0]-1)),z=f[0]*(p/T-c),s.move(f[1]*z,f[2]*z,0,null),s.scaleModel(T)}else if("il"===a[l])l++,g.interpolator=OR.Interpolator.LinearInterpolator;else if("ib"===a[l])l++,g.interpolator=OR.Interpolator.BounceInterpolator;else if("io"===a[l])l++,g.interpolator=OR.Interpolator.OvershootInterpolator;else if("ia"===a[l])l++,g.interpolator=OR.Interpolator.AnticipateInterpolator;else if("iao"===a[l])l++,g.interpolator=OR.Interpolator.AnticipateOvershootInterpolator;else if("iad"===a[l])l++,g.interpolator=OR.Interpolator.AccelerateDecelerateInterpolator;else if("iso"===a[l])l++,g.interpolator=OR.Interpolator.SpringOvershootInterpolator;else if("isb"===a[l])l++,g.interpolator=OR.Interpolator.SpringBounceInterpolator;else if("igb"===a[l])l++,g.interpolator=OR.Interpolator.GravityBounceInterpolator;else if("pt"===a[l])l++,s.selectPts(s.points);else if("seg"===a[l])l++,s.selectSegs(s.segments);else if("end"===a[l])l=a.length;else{if("t"===a[l]||"rparent"===a[l]||"u"===a[l]||"co"===a[l])return console.log("Warn unnecessary token :"+a[l]+"\n"),l++,-1;l++}return l}function R(){for(var t=[];Number.isInteger(Number(a[l]));)t.push(s.points[a[l++]]);return t}function O(){for(;l<a.length;){if("t"===a[l])return h.push(a[l++]),h.push(a[l]),i=a[l++],n=0,u=State.anim,void P();if("rparent"!==a[l]){for(var t=l,e=y();t<e;)h.push(a[t++]);s.change=!0}else h.push(a[l++])}u===State.run&&(u=State.idle)}function P(){s.change=!0,r=(new Date).getTime(),c=0}this.tokenize=x,this.readfile=v,this.execute=y,this.interpolator=d,this.toko=a,this.listPoints=R,this.listSegments=function(){for(var t=[];Number.isInteger(Number(a[l]));)t.push(s.segments[a[l++]]);return t},this.command=function(t){if(u===State.idle){if("u"===t)return void(a=h.slice().reverse());if(t.startsWith("read")){var i=t.substring(5);if(-1!==i.indexOf("script")){var r=i.substring(7);t=document.getElementById(r).text}else t=v(i.trim());if(null===t)return;h=[],[]}else{if("co"===t||"pa"===t)return;t.startsWith("d")&&(h=[],[])}return a=x(t),u=State.run,l=0,void O()}u!==State.run?u!==State.anim?u!==State.pause?u===State.undo&&!1===o&&("u"===t||("co"===t?(u=State.run,O()):"pa"===t||(l--,a=x(t),u=State.run,l=0,O()))):"co"===t?(n=(new Date).getTime()-e,O(),u=State.anim):"u"===t&&(u=State.undo):"pa"===t&&(u=State.pause):O()},this.commandLoop=O,this.anim=function(){if(u===State.undo){var t=void 0>l;return!1===t&&(o=!1),t}if(u===State.pause)return e=(new Date).getTime(),!1;if(u!==State.anim)return!1;var s=((new Date).getTime()-r-n)/i;s>1&&(s=1),p=g.interpolator(s);for(var f=l;"rparent"!==a[l];)if(y(),l===a.length){console.log("Warning missing parent !");break}if(c=p,s>=1){for(p=1,c=0;f<l;)h.push(a[f++]);return u=State.run,O(),u===State.anim}return l=f,!0}};const State={idle:0,run:1,anim:2,pause:3,undo:4};if("undefined"!=typeof exports&&(module.exports=OR.Command),"function"==typeof require)var Model=require("./Model.js"),Point=require("./Point.js"),Segment=require("./Segment.js");function View2d(t,e){(this.model=t,this.canvas2d=e,this.canvas2d.view2d=this,null!==this.canvas2d)&&(this.ctx=this.canvas2d.getContext("2d"),this.scale=1,this.xOffset=0,this.yOffset=0,function(){var t=this.model.get2DBounds(),e=t.xmax-t.xmin,n=t.ymax-t.ymin,i=this.canvas2d.clientWidth,r=this.canvas2d.clientHeight;this.canvas2d.width=i,this.canvas2d.height=r;const o=i/e,s=r/n;this.scale=Math.min(o,s)/1.2,this.xOffset=i/2,this.yOffset=r/2}.bind(this)(),this.canvas2d.addEventListener("mousedown",this.mouseDown),this.drawPoint=function(){var t=this.ctx,e=this.scale,n=this.xOffset,i=this.yOffset,r=this.model.points;t.font="18px serif",t.strokeStyle="blue";for(var o=0;o<r.length;o++){var s=r[o],a=s.xf*e+n,h=-s.yf*e+i;t.fillStyle="skyblue",t.beginPath(),t.arc(a,h,12,0,2*Math.PI),t.stroke(),t.fill(),t.fillStyle="black",o<10?t.fillText(String(o),a-4,h+5):t.fillText(String(o),a-8,h+5)}},this.drawSegment=function(){var t=this.ctx,e=this.scale,n=this.xOffset,i=this.yOffset,r=this.model.segments;t.font="18px serif",t.strokeStyle="green";for(var o=0;o<r.length;o++){var s=r[o],a=s.p1.xf*e+n,h=-s.p1.yf*e+i,l=s.p2.xf*e+n,u=-s.p2.yf*e+i,p=(a+l)/2,c=(h+u)/2;s.highlight?t.strokeStyle="red":t.strokeStyle="green",t.beginPath(),t.moveTo(a,h),t.lineTo(l,u),t.closePath(),t.stroke(),t.fillStyle="lightgreen",t.beginPath(),t.arc(p,c,12,0,2*Math.PI),t.stroke(),t.fill(),t.fillStyle="black",o<10?t.fillText(String(o),p-4,c+5):t.fillText(String(o),p-8,c+5)}},this.drawFaces=function(){var t=this.ctx,e=this.scale,n=this.xOffset,i=this.yOffset,r=this.model.faces;t.font="18px serif",t.strokeStyle="black";for(var o=0;o<r.length;o++){var s=r[o].points,a=0,h=0;t.beginPath();var l=s[0].xf*e+n,u=-s[0].yf*e+i;t.moveTo(l,u),s.forEach(function(r){l=r.xf*e+n,u=-r.yf*e+i,t.lineTo(l,u),a+=l,h+=u}),t.closePath(),t.fillStyle="lightblue",t.fill(),a/=s.length,h/=s.length,t.beginPath(),t.arc(a,h,12,0,2*Math.PI),t.stroke(),t.fillStyle="lightcyan",t.fill(),t.fillStyle="black",o<10?t.fillText(String(o),a-4,h+5):t.fillText(String(o),a-8,h+5)}},this.draw=function(){null!==this.canvas2d&&(this.ctx.clearRect(0,0,this.canvas2d.width,this.canvas2d.height),this.drawFaces(),this.drawSegment(),this.drawPoint())})}if("undefined"!=typeof exports&&(module.exports=View2d),"function"==typeof require)Model=require("./Model.js");function View3d(t,e){var n=t,i=e,r=0,o=i.getContext("webgl")||i.getContext("experimental-webgl");function s(){for(var t=[],e=[],i=[],s=[],h=[],l=[],u=[],p=0,c=0;c<n.faces.length;c++){var f=n.faces[c],d=f.points;f.computeFaceNormal();for(var m=f.normal,g=d[0],x=d[1],v=2;v<d.length;v++){var y=f.points[v];t.push(g.x+f.offset*m[0]),t.push(g.y+f.offset*m[1]),t.push(g.z+f.offset*m[2]),s.push(m[0]),s.push(m[1]),s.push(m[2]),h.push(-m[0]),h.push(-m[1]),h.push(-m[2]),e.push((200+g.xf)/View3d.wTexFront),e.push((200+g.yf)/View3d.hTexFront),i.push((200+g.xf)/View3d.wTexBack),i.push((200+g.yf)/View3d.hTexBack),l.push(p),u.push(p),p++,t.push(x.x+f.offset*m[0]),t.push(x.y+f.offset*m[1]),t.push(x.z+f.offset*m[2]),s.push(m[0]),s.push(m[1]),s.push(m[2]),h.push(-m[0]),h.push(-m[1]),h.push(-m[2]),e.push((200+x.xf)/View3d.wTexFront),e.push((200+x.yf)/View3d.hTexFront),i.push((200+x.xf)/View3d.wTexBack),i.push((200+x.yf)/View3d.hTexBack),l.push(p),u.push(p+1),p++,t.push(y.x+f.offset*m[0]),t.push(y.y+f.offset*m[1]),t.push(y.z+f.offset*m[2]),s.push(m[0]),s.push(m[1]),s.push(m[2]),h.push(-m[0]),h.push(-m[1]),h.push(-m[2]),e.push((200+y.xf)/View3d.wTexFront),e.push((200+y.yf)/View3d.hTexFront),i.push((200+y.xf)/View3d.wTexBack),i.push((200+y.yf)/View3d.hTexBack),l.push(p),u.push(p-1),p++,x=y}}var R=new Float32Array(t),O=new Float32Array(e),P=new Float32Array(i);a(o,R,3,o.FLOAT,"aVertexPosition"),a(o,O,2,o.FLOAT,"aTexCoordFront"),a(o,P,2,o.FLOAT,"aTexCoordBack");var w=o.createBuffer();o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,w);var S=new Uint8Array(l);o.bufferData(o.ELEMENT_ARRAY_BUFFER,S,o.STATIC_DRAW);var T=new Float32Array(s);a(o,T,3,o.FLOAT,"aVertexNormal"),r=S.length}function a(t,e,n,i,r){var o=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW);var s=t.getAttribLocation(t.program,r);t.vertexAttribPointer(s,n,i,!1,0,0),t.enableVertexAttribArray(s)}function h(t){t=t||1;const e=i.clientWidth*t|0,n=i.clientHeight*t|0;i.width===e&&i.height===n||(i.width=e,i.height=n)}function l(t){0===View3d.touchtime?View3d.touchtime=(new Date).getTime():(new Date).getTime()-View3d.touchtime<800?(View3d.currentAngle[0]=0,View3d.currentAngle[1]=0,View3d.scale=1,View3d.touchtime=0):View3d.touchtime=(new Date).getTime(),t.preventDefault();var e=t.changedTouches?t.changedTouches[0]:t;const n=e.clientX,i=e.clientY,r=t.target.getBoundingClientRect();r.left<=n&&n<r.right&&r.top<=i&&i<r.bottom&&(View3d.lastX=n,View3d.lastY=i,View3d.dragging=!0)}function u(t){t.preventDefault(),View3d.dragging=!1}function p(t){t.preventDefault();var e=t.changedTouches?t.changedTouches[0]:t;const n=e.clientX,i=e.clientY;if(View3d.dragging)if(t.shiftKey||void 0!==t.scale&&1!==t.scale)void 0===t.scale?(View3d.scale+=(i-View3d.lastY)/300,View3d.scale=Math.max(View3d.scale,0)):View3d.scale=t.scale;else{const e=300/t.target.height,r=e*(n-View3d.lastX),o=e*(i-View3d.lastY);View3d.currentAngle[0]=View3d.currentAngle[0]+o,View3d.currentAngle[1]=View3d.currentAngle[1]+r}View3d.lastX=n,View3d.lastY=i}(function(){const t=o.createShader(o.VERTEX_SHADER);o.shaderSource(t,vsSource),o.compileShader(t),o.getShaderParameter(t,o.COMPILE_STATUS)||(alert("An error occurred compiling the shader: "+o.getShaderInfoLog(t)),o.deleteShader(t));const e=o.createShader(o.FRAGMENT_SHADER);o.shaderSource(e,fsSource),o.compileShader(e),o.getShaderParameter(e,o.COMPILE_STATUS)||(alert("An error occurred compiling the shader: "+o.getShaderInfoLog(e)),o.deleteShader(e));const n=o.createProgram();o.attachShader(n,t),o.attachShader(n,e),o.linkProgram(n),o.useProgram(n),o.program=n})(),function(){var t=o.createTexture();o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,t),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,1,1,0,o.RGBA,o.UNSIGNED_BYTE,new Uint8Array([112,172,243,255]));var e=o.getUniformLocation(o.program,"uSamplerFront");o.uniform1i(e,0),View3d.imageFront=new Image,View3d.imageFront.onload=function(){o.activeTexture(o.TEXTURE0),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,1),o.bindTexture(o.TEXTURE_2D,t),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.RGB,o.RGB,o.UNSIGNED_BYTE,View3d.imageFront),View3d.wTexFront=View3d.imageFront.width,View3d.hTexFront=View3d.imageFront.height,s()},window.document.getElementById("front")&&(View3d.imageFront.src=window.document.getElementById("front").src);var n=o.createTexture();o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,n),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,1,1,0,o.RGBA,o.UNSIGNED_BYTE,new Uint8Array([253,236,67,255]));var i=o.getUniformLocation(o.program,"uSamplerBack");o.uniform1i(i,1),View3d.imageBack=new Image,View3d.imageBack.onload=function(){o.activeTexture(o.TEXTURE1),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,1),o.bindTexture(o.TEXTURE_2D,n),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.RGB,o.RGB,o.UNSIGNED_BYTE,View3d.imageBack),View3d.wTexBack=View3d.imageBack.width,View3d.hTexBack=View3d.imageBack.height,s()},window.document.getElementById("back")&&(View3d.imageBack.src=window.document.getElementById("back").src)}(),function(){o.clearColor(.8,228/255,1,1),o.clearDepth(1),o.enable(o.DEPTH_TEST),o.depthFunc(o.LEQUAL),h(),o.viewport(0,0,i.width,i.height),o.viewport(0,0,i.width,i.height);var t=View3d.projectionMatrix,e=i.width/i.height,n=30,r=-30,s=-30,a=30;e>=1?(n=50*Math.tan(Math.PI/360*40),s=(r=-n)*e,a=n*e):(a=50*Math.tan(Math.PI/360*40),n=a/e,r=(s=-a)/e);var l=a-s,u=n-r;t[0]=100/l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=100/u,t[6]=0,t[7]=0,t[8]=(s+a)/l,t[9]=(n+r)/u,t[10]=-1250/1150,t[11]=-1,t[12]=0,t[13]=0,t[14]=-12e4/1150,t[15]=0,t[15]+=700;var p=o.getUniformLocation(o.program,"uProjectionMatrix");o.uniformMatrix4fv(p,!1,t)}(),View3d.lastX=-1,View3d.lastY=-1,View3d.touchtime=0,i.addEventListener("mousedown",l),i.addEventListener("mouseup",u),i.addEventListener("mousemove",p),i.addEventListener("touchstart",l,{capture:!0,passive:!1}),i.addEventListener("touchend",u,{capture:!0,passive:!1}),i.addEventListener("touchmove",p,{capture:!0,passive:!1}),this.initBuffers=s,this.draw=function(){h(),o.useProgram(o.program);var t=View3d.modelViewMatrix,e=Math.sin(View3d.currentAngle[0]/200),n=Math.cos(View3d.currentAngle[0]/200);t[0]=1,t[4]=0,t[8]=0,t[12]=0,t[1]=0,t[5]=n,t[9]=-e,t[13]=0,t[2]=0,t[6]=e,t[10]=n,t[14]=0,t[3]=0,t[7]=0,t[11]=0,t[15]=1;var i=t.slice(0);e=Math.sin(View3d.currentAngle[1]/100),n=Math.cos(View3d.currentAngle[1]/100),i[0]=n*t[0]-e*t[8],i[4]=t[4],i[8]=n*t[8]+e*t[0],i[12]=t[12],i[1]=n*t[1]-e*t[9],i[5]=t[5],i[9]=n*t[9]+e*t[1],i[13]=t[13],i[2]=n*t[2]-e*t[10],i[6]=t[6],i[10]=n*t[10]+e*t[2],i[14]=t[14],i[3]=n*t[3]-e*t[11],i[7]=t[7],i[11]=n*t[11]+e*t[3],i[15]=t[15];var s=View3d.scale;t[0]=s*i[0],t[4]=s*i[4],t[8]=s*i[8],t[12]=i[12],t[1]=s*i[1],t[5]=s*i[5],t[9]=s*i[9],t[13]=i[13],t[2]=s*i[2],t[6]=s*i[6],t[10]=s*i[10],t[14]=i[14],t[3]=i[3],t[7]=i[7],t[11]=i[11],t[15]=i[15];var a=o.getUniformLocation(o.program,"uModelViewMatrix");o.uniformMatrix4fv(a,!1,t),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),o.activeTexture(o.TEXTURE0),o.cullFace(o.BACK),o.drawElements(o.TRIANGLES,r,o.UNSIGNED_BYTE,0),o.activeTexture(o.TEXTURE1),o.cullFace(o.FRONT),o.drawElements(o.TRIANGLES,r,o.UNSIGNED_BYTE,0)}}const vsSource="\n    attribute vec4 aVertexPosition;\n    attribute vec3 aVertexNormal;\n    attribute vec2 aTexCoordFront;\n    attribute vec2 aTexCoordBack;\n\n    uniform mat4 uModelViewMatrix;\n    uniform mat4 uProjectionMatrix;\n\n    varying highp vec2 vTexCoordFront;\n    varying highp vec2 vTexCoordBack;\n    varying highp vec3 vLighting;\n    varying vec4 vPos;\n\n    void main(void) {\n      // Vertex position\n      gl_Position = uProjectionMatrix * uModelViewMatrix * aVertexPosition;\n      vPos = gl_Position;\n\n      // Pass to fragment\n      vTexCoordFront = aTexCoordFront;\n      vTexCoordBack  = aTexCoordBack;\n\n      // Lighting transform normal and dot with direction\n      highp vec3 lightColor = vec3(0.8, 0.8, 0.8); \n      highp vec3 direction = vec3(0.0, 0.0, 1.0);  \n      highp vec4 normal = normalize(uModelViewMatrix * vec4(aVertexNormal, 1.0));\n      // dot product is negative for back face\n      highp float dot = dot(normal.xyz, direction);\n      \n      // Pass to fragment\n      vLighting = lightColor * dot;\n    }\n  ",fsSource="\n    precision highp float;\n\n    varying highp vec2 vTexCoordFront;\n    varying highp vec2 vTexCoordBack;\n    varying highp vec3 vLighting;\n    \n    uniform sampler2D uSamplerFront;\n    uniform sampler2D uSamplerBack;\n\n    void main(void) {\n      highp vec4 texelColor;\n      vec3 normal;\n      if (gl_FrontFacing) {\n        texelColor = texture2D(uSamplerFront, vTexCoordFront);\n        normal = texelColor.rgb * vLighting;\n      } else {\n        texelColor = texture2D(uSamplerBack,  vTexCoordBack);\n        normal = texelColor.rgb * vLighting * -1.0;\n      }\n      // Ambiant\n      vec3 ambiant = texelColor.rgb * 0.5;\n      // Ambiant + normal\n      gl_FragColor = vec4(ambiant + normal, texelColor.a);\n    }\n  ";if(View3d.currentAngle=[0,0],View3d.scale=1,View3d.projectionMatrix=new Float32Array(16),View3d.modelViewMatrix=new Float32Array(16),View3d.wTexFront=1,View3d.hTexFront=1,View3d.wTexBack=1,View3d.hTexBack=1,"undefined"!=typeof exports&&(module.exports=View3d),"function"==typeof require)var Command=require("./Command.js");function CommandArea(t,e){e.addEventListener("keypress",CommandArea.keypress),CommandArea.textArea=e,CommandArea.cde=t}(CommandArea.keypress=function(t){var e=t.target,n=t.key?t.key:String.fromCharCode(Number(t.charCode));if(n=13===t.keyCode?"Enter":n,t.target.scrollTop=t.target.scrollHeight,"Enter"===n){var i=e.selectionStart,r=e.value,o=r.lastIndexOf("\n",i-1)+1,s=r.indexOf("\n",i);-1===s&&(e.value+="\n",s=r.length);var a=r.substring(o,s);t.preventDefault(),s!==r.length&&(e.value+=a+"\n"),CommandArea.cde.command(a)}},CommandArea.prototype={constructor:CommandArea},"undefined"!=typeof exports&&(module.exports=CommandArea),"function"==typeof require)&&((OR=OR||{}).Model=require("./Model.js"),OR.View2d=require("./View2d.js"),OR.View3d=require("./View3d.js"),OR.Command=require("./Command.js"),OR.CommandArea=require("./CommandArea.js"));function Orisim3d(t,e,n,i){this.model=t,this.view2d=e,this.view3d=n,this.command=i}function completed(){window.removeEventListener("load",completed);var t=new OR.Model;t.init([-200,-200,200,-200,200,200,-200,200]);var e=new OR.Command(t),n=window.document.getElementById("canvas2d"),i=n?new View2d(t,n):null,r=window.document.getElementById("canvas3d"),o=r?new View3d(t,r):null,s=window.document.getElementById("commandarea");s&&new CommandArea(e,s),OR.orisim3d=new Orisim3d(t,i,o,e);var a=document.getElementById("cocotte.txt");OR.orisim3d.command.command(a.textContent),requestAnimationFrame(loop)}function loop(){OR.orisim3d.model.change&&(null!==OR.orisim3d.view2d&&OR.orisim3d.view2d.draw(),null!==OR.orisim3d.view3d&&OR.orisim3d.view3d.initBuffers(),OR.orisim3d.model.change=!!OR.orisim3d.command.anim()),OR.orisim3d.view3d.draw(),requestAnimationFrame(loop)}"undefined"!=typeof window&&window.addEventListener("load",completed),"undefined"!=typeof exports&&(module.exports=Orisim3d);